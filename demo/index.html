<html>

<head>
  <script src='https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.js'></script>
  <link href='https://api.mapbox.com/mapbox-gl-js/v2.5.0/mapbox-gl.css' rel='stylesheet' />
  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
  <script src="./dist/main.js"></script>

  <title>Vue-MapX Demo page</title>
  <link rel="shortcut icon" href="#">
  <style type="text/css">
    .wrapper {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-gap: 10px;
    }

    textarea {
      width: 100%;
      min-height: 30em;
    }
  </style>
</head>

<body>
  <div id="app"></div>
</body>

<script type="text/javascript">
  Vue.use(VueMapX.default, mapboxgl, 'pk.eyJ1IjoibWFicmVuYWMiLCJhIjoiY2sxbm1ueWhjMDd6aTNvcWZhNWVzejEyZiJ9.y6D5gNxGbMDJnzd0CSW9xQ');

  const app = new Vue({
    el: '#app',
    template: `<section class="mpx-map-wrapper">
      <mx-map v-bind="map"
      @load="debug" 
      @dragend="debug" 
      @contextmenu="addWaypoint"
      @mousemove="pointerPosition = getElevation($event)"
      >
        <template #loader>{{ message }}</template>
        <mx-source id="flight" :data="fly.data" v-bind="fly.source">
        <mx-layer v-bind="fly.layer" @click="fly.layer.paint['line-color'] = randomColor()" />
        </mx-source>
        <mx-i-control position="top-left">
          <span>{{message}}</span>
          <div>{{  pointerPosition }} m</div>
        </mx-i-control>
        <mx-navigation-control visualizePitch/>
        <mx-style v-bind="style"/>
        <mx-marker v-bind="marker" @dragend="debug">
          <mx-popup v-bind="popup">{{ message }}</mx-popup>
        </mx-marker>
        <mx-layer v-bind="walk" @click="walk.paint['line-color'] = randomColor()" />
        <mx-popup v-bind="popup">{{ message }}</mx-popup>
        <mx-popup v-bind="tooltip">{{  pointerPosition }}</mx-popup>
        <mx-attribution-control :customAttribution="message"/>
        <mx-scale-control v-bind="scale" />
        <mx-fullscreen-control/>
        <mx-geolocate-control/>
        <mx-layer v-bind="sky"/>
      </mx-map>
          </section>`,
    data() {
      return {
        message: 'Hello VueMapX!',
        pointerPosition: undefined,
        map: {
          testMode: true,
          attributionControl: false,
          // using `mapStyle` for `style` because it is a reserved word
          mapStyle: 'mapbox://styles/mapbox/streets-v11',
          center: [44.3763, 33.2788],
          zoom: 11
        },
        marker: {
          draggable: true,
          color: 'red',
          lngLat: {
            lat: 33.32442445164719,
            lng: 44.26575004569881
          }
        },
        scale: {
          unit: 'nautical',
          position: 'bottom-left'
        },
        popup: {
          offset: 15,
          lngLat: {
            lat: 33.22195126761062,
            lng: 44.31930842285104
          }
        },
        tooltip: {
          closeButton: false,
          trackPointer: true
        },
        style: {
          light: {
            anchor: 'viewport',
            color: 'white',
            intensity: 0.4
          },
          terrain: {
            "source": {
              'type': 'raster-dem',
              'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
              'tileSize': 512,
              'maxzoom': 14
            },
            "exaggeration": 2
          },
          fog: {
            "range": [-0.5, 3],
            "color": "white",
            "horizon-blend": 0.1
          }
        },
        // https://docs.mapbox.com/mapbox-gl-js/example/atmospheric-sky/
        sky: {
          'id': 'sky',
          'type': 'sky',
          'paint': {
            'sky-opacity': [
              'interpolate',
              ['linear'],
              ['zoom'],
              0,
              0,
              5,
              0.3,
              8,
              1
            ],
            'sky-type': 'atmosphere',
            'sky-atmosphere-sun': [180, 30],
            'sky-atmosphere-sun-intensity': 5
          }
        },
        walk: {
          'id': 'route',
          'type': 'line',
          'source': {
            'type': 'geojson',
            'data': {
              'type': 'Feature',
              'properties': {},
              'geometry': {
                'type': 'LineString',
                'coordinates': [
                  [44.229248858442986, 33.26456452284866],
                  [44.22770987878036, 33.26401424951273],
                  [44.22776505458151, 33.261304205440425],
                  [44.225182961928056, 33.26033952527986],
                  [44.21914334503879, 33.26892721824875],
                  [44.218264306162666, 33.26920290224669],
                  [44.21672643349413, 33.2684222988276],
                  [44.228808301666334, 33.25133462122925]
                ]

              }
            }
          },
          'layout': {
            'line-join': 'round',
            'line-cap': 'round'
          },
          'paint': {
            'line-color': '#888',
            'line-width': 8
          }
        },
        fly: {
          data: {
            'type': 'Feature',
            'properties': {},
            'geometry': {
              'type': 'LineString',
              'coordinates': [
                [44.229248858442986, 33.26456452284866],
                [44.22770987878036, 33.26401424951273],
              ]
            }
          },
          source: {
            'type': 'geojson',
          },
          layer: {
            'id': 'route',
            'type': 'line',
            'layout': {
              'line-join': 'round',
              'line-cap': 'round'
            },
            'paint': {
              'line-color': '#888',
              'line-width': 8
            }
          }
        }
      }
    },
    methods: {
      debug: console.debug,
      randomColor() {
        return `hsl(${(360 * Math.random())},50%,50%)`
      },
      getElevation({ target, lngLat }) {
        return Math.round(target.queryTerrainElevation(lngLat));
      },
      addWaypoint({ lngLat }) {
        this.fly.data.geometry.coordinates.push([lngLat.lng, lngLat.lat]);
      }
    }
  })
</script>

</html>